import React, { useState } from 'react';
import { BarChart, Bar, PieChart, Pie, Cell, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, Label } from 'recharts';

// Componente de tarjeta de estadísticas
const StatCard = ({ icon, label, value, sublabel, color = 'blue' }) => {
  const gradients = {
    blue: 'from-blue-500 to-blue-600',
    purple: 'from-purple-500 to-purple-600',
    green: 'from-green-500 to-green-600',
    orange: 'from-orange-500 to-orange-600',
    pink: 'from-pink-500 to-pink-600',
    indigo: 'from-indigo-500 to-indigo-600',
  };

  return (
    <div className={`bg-gradient-to-br ${gradients[color]} text-white p-6 rounded-2xl shadow-lg`}>
      <div className="text-3xl mb-2">{icon}</div>
      <p className="text-sm font-semibold opacity-90 mb-1">{label}</p>
      <p className="text-3xl font-bold mb-1">{value}</p>
      {sublabel && <p className="text-xs opacity-75">{sublabel}</p>}
    </div>
  );
};

// Componente de caja de análisis
const InsightBox = ({ title, children, color = 'blue' }) => {
  const gradients = {
    blue: 'from-blue-50 to-blue-100 border-blue-500',
    purple: 'from-purple-50 to-purple-100 border-purple-500',
    green: 'from-green-50 to-green-100 border-green-500',
    orange: 'from-orange-50 to-orange-100 border-orange-500',
    pink: 'from-pink-50 to-pink-100 border-pink-500',
    indigo: 'from-indigo-50 to-indigo-100 border-indigo-500',
  };

  return (
    <div className={`bg-gradient-to-br ${gradients[color]} border-l-4 p-6 rounded-lg shadow-sm`}>
      <h4 className="font-bold text-gray-900 mb-3 flex items-center text-xl">
        <span className="mr-2 text-2xl">💡</span>
        {title}
      </h4>
      <div className="text-gray-800 text-base leading-relaxed font-medium">
        {children}
      </div>
    </div>
  );
};

// Tooltip personalizado mejorado con popup llamativo
const CustomTooltip = ({ active, payload }) => {
  if (active && payload && payload.length) {
    const data = payload[0].payload;
    const primaryValue = payload[0].value;
    const secondaryValue = payload[1]?.value;
    const hasPercentage = data.percentage !== undefined;

    return (
      <div className="bg-gradient-to-br from-slate-900 to-slate-800 px-8 py-6 rounded-2xl shadow-[0_20px_60px_rgba(0,0,0,0.5)] border-4 border-yellow-400 transform scale-105 animate-scaleIn">
        {/* Título del popup */}
        <div className="flex items-center gap-3 mb-4 border-b-2 border-yellow-400 pb-3">
          <div className="text-4xl">📊</div>
          <p className="font-black text-white text-2xl">
            {data.name || data.range || data.area || data.duration || payload[0].name}
          </p>
        </div>

        {/* Valor principal */}
        <div className="mb-3">
          <p className="text-gray-300 text-sm font-semibold mb-1 uppercase tracking-wide">
            {payload[0].dataKey === 'matricula' ? 'Matrícula' :
             payload[0].dataKey === 'arancel' ? 'Arancel' :
             payload[0].dataKey === 'students' ? 'Estudiantes' :
             payload[0].dataKey === 'programs' ? 'Programas' :
             payload[0].name || 'Valor'}
          </p>
          <p className="text-5xl font-black bg-gradient-to-r from-yellow-300 to-orange-400 bg-clip-text text-transparent">
            {primaryValue?.toLocaleString('es-CL')}
          </p>
        </div>

        {/* Valor secundario (para gráficos con 2 barras) */}
        {secondaryValue && (
          <div className="mb-3 mt-4 pt-3 border-t border-gray-600">
            <p className="text-gray-300 text-sm font-semibold mb-1 uppercase tracking-wide">
              {payload[1].dataKey === 'matricula' ? 'Matrícula' :
               payload[1].dataKey === 'arancel' ? 'Arancel' :
               payload[1].name}
            </p>
            <p className="text-4xl font-black bg-gradient-to-r from-blue-300 to-cyan-400 bg-clip-text text-transparent">
              {secondaryValue?.toLocaleString('es-CL')}
            </p>
          </div>
        )}

        {/* Porcentaje si está disponible */}
        {hasPercentage && (
          <div className="mt-4 pt-3 border-t border-gray-600">
            <div className="flex items-center justify-between">
              <span className="text-gray-300 text-sm font-semibold uppercase tracking-wide">Porcentaje</span>
              <div className="flex items-center gap-2">
                <div className="bg-gradient-to-r from-green-400 to-emerald-500 px-4 py-2 rounded-lg">
                  <span className="text-white font-black text-2xl">{data.percentage}%</span>
                </div>
              </div>
            </div>
          </div>
        )}

        {/* Decoración inferior */}
        <div className="mt-4 pt-2 flex justify-center">
          <div className="h-1 w-20 bg-gradient-to-r from-yellow-400 via-orange-400 to-yellow-400 rounded-full"></div>
        </div>
      </div>
    );
  }
  return null;
};

function App() {
  const [activeTab, setActiveTab] = useState(-1); // -1 para página de inicio
  const [showIntro, setShowIntro] = useState(true);

  // Navegación con teclado
  React.useEffect(() => {
    const handleKeyPress = (e) => {
      if (showIntro && (e.key === 'ArrowRight' || e.key === ' ')) {
        // Desde intro ir a primera sección
        setShowIntro(false);
        setActiveTab(0);
      } else if (!showIntro) {
        if (e.key === 'ArrowRight' || e.key === ' ') {
          setActiveTab((prev) => (prev + 1) % 8);
        } else if (e.key === 'ArrowLeft') {
          if (activeTab === 0) {
            // Si estoy en la primera sección, volver a intro
            setShowIntro(true);
            setActiveTab(-1);
          } else {
            setActiveTab((prev) => (prev - 1 + 8) % 8);
          }
        } else if (e.key >= '1' && e.key <= '8') {
          setActiveTab(parseInt(e.key) - 1);
        }
      }
    };

    window.addEventListener('keydown', handleKeyPress);
    return () => window.removeEventListener('keydown', handleKeyPress);
  }, [showIntro, activeTab]);

  const nextSlide = () => {
    if (showIntro) {
      setShowIntro(false);
      setActiveTab(0);
    } else {
      setActiveTab((prev) => (prev + 1) % 8);
    }
  };

  const prevSlide = () => {
    if (activeTab === 0) {
      setShowIntro(true);
      setActiveTab(-1);
    } else {
      setActiveTab((prev) => (prev - 1 + 8) % 8);
    }
  };

  // Paleta de colores
  const COLORS = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E2', '#F8B739', '#E74C3C'];
  const GENDER_COLORS = ['#EC4899', '#3B82F6'];

  // Datos estadísticos
  const genderData = [
    { name: 'Femenino', value: 3265, percentage: 56.33 },
    { name: 'Masculino', value: 2531, percentage: 43.67 }
  ];

  const ageRangeData = [
    { range: '15-19', students: 1247, percentage: 20.8 },
    { range: '20-24', students: 2834, percentage: 47.3 },
    { range: '25-29', students: 1456, percentage: 24.3 },
    { range: '30-34', students: 678, percentage: 11.3 },
    { range: '35-39', students: 345, percentage: 5.8 },
    { range: '40+', students: 427, percentage: 7.1 }
  ];

  const institutionData = [
    { name: 'U. de Magallanes (CRUCH)', students: 2456, percentage: 41.0 },
    { name: 'INACAP', students: 1834, percentage: 30.6 },
    { name: 'Universidades Privadas', students: 1123, percentage: 18.8 },
    { name: 'Otros CFT/IP', students: 1574, percentage: 26.3 }
  ];

  const modalityData = [
    { name: 'Presencial', value: 5821, percentage: 97.2 },
    { name: 'Online', value: 166, percentage: 2.8 }
  ];

  const scheduleData = [
    { name: 'Diurno', students: 4245, percentage: 60.9 },
    { name: 'Vespertino', students: 1689, percentage: 24.2 },
    { name: 'Ejecutivo', students: 1053, percentage: 15.1 }
  ];

  const knowledgeAreasData = [
    { area: 'Salud', students: 1501, percentage: 25.1 },
    { area: 'Tecnología', students: 1331, percentage: 22.2 },
    { area: 'Administración y Comercio', students: 1221, percentage: 20.4 },
    { area: 'Educación', students: 653, percentage: 10.9 },
    { area: 'Ciencias Sociales', students: 531, percentage: 8.9 },
    { area: 'Derecho', students: 491, percentage: 8.2 },
    { area: 'Ingeniería', students: 423, percentage: 7.1 },
    { area: 'Arte y Arquitectura', students: 332, percentage: 5.5 },
    { area: 'Ciencias Básicas', students: 273, percentage: 4.6 },
    { area: 'Agropecuaria', students: 231, percentage: 3.9 }
  ];

  const durationData = [
    { duration: '4-5 sem', programs: 234, percentage: 9.8 },
    { duration: '6-7 sem', programs: 456, percentage: 19.1 },
    { duration: '8-9 sem', programs: 789, percentage: 33.1 },
    { duration: '10 sem', programs: 821, percentage: 34.4 },
    { duration: '11-14 sem', programs: 367, percentage: 15.4 }
  ];

  const costsData = [
    { range: '$0-$137k', matricula: 312, arancel: 234 },
    { range: '$137k (Moda)', matricula: 789, arancel: 456 },
    { range: '$138k-$500k', matricula: 445, arancel: 389 },
    { range: '$500k-$2.2M', matricula: 334, arancel: 678 },
    { range: '$2.2M-$3.5M', matricula: 289, arancel: 823 },
    { range: '$3.5M+', matricula: 123, arancel: 534 }
  ];

  // Tabs configuration
  const tabs = [
    { name: '📊 Resumen', icon: '📊' },
    { name: '👥 Género', icon: '👥' },
    { name: '🎂 Edad', icon: '🎂' },
    { name: '🏛️ Instituciones', icon: '🏛️' },
    { name: '💻 Modalidad', icon: '💻' },
    { name: '📚 Áreas', icon: '📚' },
    { name: '⏱️ Duración', icon: '⏱️' },
    { name: '💰 Costos', icon: '💰' }
  ];

  // Renderizado de etiquetas personalizadas en barras
  const renderCustomLabel = (props) => {
    const { x, y, width, height, value } = props;
    return (
      <text x={x + width / 2} y={y - 8} fill="#1e293b" textAnchor="middle" fontSize={18} fontWeight="900">
        {value.toLocaleString('es-CL')}
      </text>
    );
  };

  return (
    <div className="w-full min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 p-4">
      <div className="w-full px-4">
        {/* Página de Inicio */}
        {showIntro && (
          <div className="flex items-center justify-center min-h-screen animate-fadeIn">
            <div className="text-center max-w-5xl">
              <div className="mb-12">
                <h1 className="text-8xl md:text-9xl font-bold bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 bg-clip-text text-transparent mb-8 animate-scaleIn">
                  Estadísticas de Educación Superior
                </h1>
                <p className="text-4xl md:text-5xl text-gray-700 font-bold mb-6 animate-slideInRight">
                  Región de Magallanes y Antártica Chilena
                </p>
                <p className="text-3xl text-gray-600 font-semibold mb-8">Año 2021</p>
                <div className="inline-block bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-12 py-6 rounded-3xl shadow-2xl animate-pulse-slow">
                  <p className="text-5xl font-black">5,796 estudiantes</p>
                </div>
              </div>

              <div className="mt-16 flex flex-col items-center gap-6">
                <div className="text-gray-500 text-2xl font-semibold animate-bounce">
                  Presiona → o Espacio para comenzar
                </div>
                <button
                  onClick={nextSlide}
                  className="bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-12 py-6 rounded-2xl font-bold text-2xl shadow-2xl hover:scale-110 transition-all duration-300"
                >
                  Comenzar Presentación →
                </button>
              </div>
            </div>
          </div>
        )}

        {/* Contenido Principal (solo cuando NO es intro) */}
        {!showIntro && (
          <>
            {/* Navigation Tabs */}
            <div className="flex flex-wrap gap-4 justify-center mb-10">
              {tabs.map((tab, index) => (
                <button
                  key={index}
                  onClick={() => setActiveTab(index)}
                  className={`px-8 py-4 rounded-xl font-bold text-lg transition-all duration-300 ${
                    activeTab === index
                      ? 'bg-gradient-to-r from-blue-600 to-indigo-600 text-white shadow-2xl scale-110'
                      : 'bg-white text-gray-700 hover:shadow-lg hover:scale-105 border-2 border-gray-200'
                  }`}
                >
                  <span className="mr-2 text-2xl">{tab.icon}</span>
                  {tab.name.replace(/^[^\s]+ /, '')}
                </button>
              ))}
            </div>

            {/* Content */}
            {activeTab === 0 && (
              <div className="bg-white rounded-3xl shadow-2xl p-8 min-h-[600px] animate-fadeIn">
            <h2 className="text-4xl md:text-5xl font-bold text-gray-900 mb-8 text-center">Resumen Ejecutivo - Medidas Estadísticas</h2>

            {/* Medidas de Tendencia Central */}
            <div>
              <h3 className="text-2xl font-bold text-gray-800 mb-4">📈 Medidas de Tendencia Central</h3>
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                <StatCard icon="🎂" label="Edad Promedio" value="24.42 años" sublabel="Mediana: 22 | Moda: 19" color="blue" />
                <StatCard icon="⏱️" label="Duración Carrera" value="7.86 sem" sublabel="Mediana: 8 | Moda: 10" color="purple" />
                <StatCard icon="💳" label="Matrícula Promedio" value="$145,774" sublabel="Mediana: $137k | Moda: $137k" color="green" />
                <StatCard icon="💰" label="Arancel Promedio" value="$2,693,403" sublabel="Mediana: $2.2M | Moda: $3.5M" color="orange" />
              </div>

              <InsightBox title="¿Qué significan estos números?" color="blue">
                <p className="mb-2"><strong>📊 MEDIA:</strong> Es el promedio. Se suma todo y se divide por la cantidad total.</p>
                <p className="mb-2"><strong>📊 MEDIANA:</strong> Es el valor del medio. La mitad está arriba y la mitad abajo de este número.</p>
                <p className="mb-2"><strong>📊 MODA:</strong> Es el valor más frecuente. El que más se repite en los datos.</p>
                <p className="mt-4 font-bold text-lg">🔍 Conclusiones:</p>
                <p>• La mayoría de los estudiantes tiene 19 años (recién salidos del colegio)</p>
                <p>• Las carreras más comunes duran 10 semestres (5 años de universidad)</p>
                <p>• El arancel más frecuente es $3.555.000 al año</p>
              </InsightBox>
            </div>

            {/* Tabla comparativa */}
            <div className="bg-white rounded-xl shadow-xl overflow-hidden mt-6">
              <div className="overflow-x-auto">
                <table className="w-full">
                  <thead className="bg-gradient-to-r from-indigo-600 to-purple-600 text-white">
                    <tr>
                      <th className="px-6 py-4 text-left text-lg font-bold">Variable</th>
                      <th className="px-6 py-4 text-right text-lg font-bold">Media (Promedio)</th>
                      <th className="px-6 py-4 text-right text-lg font-bold">Mediana (Valor Medio)</th>
                      <th className="px-6 py-4 text-right text-lg font-bold">Moda (Más Común)</th>
                    </tr>
                  </thead>
                  <tbody className="divide-y divide-gray-200">
                    <tr className="hover:bg-blue-50 transition-colors">
                      <td className="px-6 py-5 font-bold text-gray-800 text-base">Edad (años)</td>
                      <td className="px-6 py-5 text-right font-semibold text-base">24.42</td>
                      <td className="px-6 py-5 text-right font-semibold text-base">22.0</td>
                      <td className="px-6 py-5 text-right font-semibold text-base">19</td>
                    </tr>
                    <tr className="hover:bg-blue-50 transition-colors">
                      <td className="px-6 py-5 font-bold text-gray-800 text-base">Duración Carrera (Semestres)</td>
                      <td className="px-6 py-5 text-right font-semibold text-base">7.86</td>
                      <td className="px-6 py-5 text-right font-semibold text-base">8.0</td>
                      <td className="px-6 py-5 text-right font-semibold text-base">10</td>
                    </tr>
                    <tr className="hover:bg-blue-50 transition-colors">
                      <td className="px-6 py-5 font-bold text-gray-800 text-base">Valor Matrícula (Pesos)</td>
                      <td className="px-6 py-5 text-right font-semibold text-base">$145,774</td>
                      <td className="px-6 py-5 text-right font-semibold text-base">$137,000</td>
                      <td className="px-6 py-5 text-right font-semibold text-base">$137,000</td>
                    </tr>
                    <tr className="hover:bg-blue-50 transition-colors">
                      <td className="px-6 py-5 font-bold text-gray-800 text-base">Valor Arancel (Pesos)</td>
                      <td className="px-6 py-5 text-right font-semibold text-base">$2,693,403</td>
                      <td className="px-6 py-5 text-right font-semibold text-base">$2,234,000</td>
                      <td className="px-6 py-5 text-right font-semibold text-base">$3,555,000</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            {/* Medidas de Dispersión */}
            <div>
              <h3 className="text-2xl font-bold text-gray-800 mb-4 mt-8">📊 Medidas de Dispersión</h3>
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                <StatCard icon="📏" label="Rango Edad" value="40 años" sublabel="Desv. Est: 6.38 | CV: 26.14%" color="pink" />
                <StatCard icon="📐" label="Rango Duración" value="13 semestres" sublabel="Desv. Est: 3.1 | CV: 39.48%" color="indigo" />
                <StatCard icon="📊" label="Rango Matrícula" value="$290,000" sublabel="Desv. Est: $50,895 | CV: 34.91%" color="purple" />
                <StatCard icon="📈" label="Rango Arancel" value="$5,011,000" sublabel="Desv. Est: $1,070,871 | CV: 39.76%" color="orange" />
              </div>

              <InsightBox title="¿Qué tan dispersos están los datos?" color="orange">
                <p className="mb-2"><strong>📏 RANGO:</strong> Es la diferencia entre el valor más alto y el más bajo.</p>
                <p className="mb-2"><strong>📐 DESVIACIÓN ESTÁNDAR:</strong> Mide qué tan alejados están los datos del promedio.</p>
                <p className="mb-2"><strong>📊 COEFICIENTE DE VARIACIÓN (CV):</strong> Indica el % de variabilidad. Más de 30% = alta dispersión.</p>
                <p className="mt-4 font-bold text-lg">🔍 Conclusiones:</p>
                <p>• Hay GRAN variedad de costos: desde carreras técnicas baratas hasta medicina y odontología caras</p>
                <p>• Las duraciones varían mucho: hay carreras cortas (2 años) y largas (7 años)</p>
                <p>• Las edades van desde 15 hasta 55 años (rango de 40 años)</p>
              </InsightBox>
            </div>

            {/* Tabla de dispersión */}
            <div className="bg-white rounded-xl shadow-xl overflow-hidden">
              <div className="overflow-x-auto">
                <table className="w-full">
                  <thead className="bg-gradient-to-r from-orange-600 to-red-600 text-white">
                    <tr>
                      <th className="px-6 py-4 text-left">Variable</th>
                      <th className="px-6 py-4 text-right">Rango</th>
                      <th className="px-6 py-4 text-right">Desv. Estándar</th>
                      <th className="px-6 py-4 text-right">Coef. Variación</th>
                    </tr>
                  </thead>
                  <tbody className="divide-y divide-gray-200">
                    <tr className="hover:bg-orange-50 transition-colors">
                      <td className="px-6 py-4 font-semibold text-gray-800">Edad (años)</td>
                      <td className="px-6 py-4 text-right">40</td>
                      <td className="px-6 py-4 text-right">6.38</td>
                      <td className="px-6 py-4 text-right">26.14%</td>
                    </tr>
                    <tr className="hover:bg-orange-50 transition-colors">
                      <td className="px-6 py-4 font-semibold text-gray-800">Duración Carrera (Semestres)</td>
                      <td className="px-6 py-4 text-right">13</td>
                      <td className="px-6 py-4 text-right">3.10</td>
                      <td className="px-6 py-4 text-right">39.48%</td>
                    </tr>
                    <tr className="hover:bg-orange-50 transition-colors">
                      <td className="px-6 py-4 font-semibold text-gray-800">Valor Matrícula (Pesos)</td>
                      <td className="px-6 py-4 text-right">$290,000</td>
                      <td className="px-6 py-4 text-right">$50,895</td>
                      <td className="px-6 py-4 text-right">34.91%</td>
                    </tr>
                    <tr className="hover:bg-orange-50 transition-colors">
                      <td className="px-6 py-4 font-semibold text-gray-800">Valor Arancel (Pesos)</td>
                      <td className="px-6 py-4 text-right">$5,011,000</td>
                      <td className="px-6 py-4 text-right">$1,070,871</td>
                      <td className="px-6 py-4 text-right">39.76%</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        )}

        {/* Tab 1: Distribución por Género */}
            {activeTab === 1 && (
          <div className="bg-white rounded-3xl shadow-2xl p-8 min-h-[600px] animate-fadeIn">
            <h2 className="text-4xl md:text-5xl font-bold text-gray-900 mb-8 text-center">Distribución por Género</h2>
            <div>
              <ResponsiveContainer width="100%" height={500}>
                <PieChart>
                  <Pie
                    data={genderData}
                    cx="50%"
                    cy="50%"
                    labelLine={false}
                    label={({ name, percentage }) => `${name}: ${percentage}%`}
                    outerRadius={160}
                    fill="#8884d8"
                    dataKey="value"
                    style={{ fontSize: '20px', fontWeight: 'bold' }}
                  >
                    {genderData.map((entry, index) => (
                      <Cell key={`cell-${index}`} fill={GENDER_COLORS[index % GENDER_COLORS.length]} />
                    ))}
                  </Pie>
                  <Tooltip content={<CustomTooltip />} />
                  <Legend />
                </PieChart>
              </ResponsiveContainer>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
                <StatCard icon="👩" label="Mujeres" value="3,265" sublabel="56.33% del total" color="pink" />
                <StatCard icon="👨" label="Hombres" value="2,531" sublabel="43.67% del total" color="blue" />
              </div>

              <InsightBox title="Análisis de Género" color="purple" >
                <p>• 56.33% mujeres vs 43.67% hombres: mayoría femenina ligera</p>
                <p>• Refleja tendencia nacional de feminización de educación superior</p>
                <p>• Consistente con predominio femenino en áreas como Salud y Educación</p>
              </InsightBox>
            </div>
          </div>
        )}

        {/* Tab 2: Rango de Edad */}
            {activeTab === 2 && (
          <div className="bg-white rounded-3xl shadow-2xl p-8 min-h-[600px] animate-fadeIn">
            <h2 className="text-4xl md:text-5xl font-bold text-gray-900 mb-8 text-center">Rango de Edad</h2>
            <div>
              <ResponsiveContainer width="100%" height={500}>
                <BarChart data={ageRangeData}>
                  <CartesianGrid strokeDasharray="3 3" stroke="#d1d5db" strokeWidth={2} />
                  <XAxis
                    dataKey="range"
                    tick={{ fill: '#1e293b', fontSize: 16, fontWeight: 'bold' }}
                    height={60}
                  />
                  <YAxis
                    tick={{ fill: '#1e293b', fontSize: 16, fontWeight: 'bold' }}
                  />
                  <Tooltip content={<CustomTooltip />} />
                  <Legend wrapperStyle={{ fontSize: '16px', fontWeight: 'bold' }} />
                  <Bar dataKey="students" fill="#4ECDC4" radius={[12, 12, 0, 0]} label={renderCustomLabel}>
                    {ageRangeData.map((entry, index) => (
                      <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                    ))}
                  </Bar>
                </BarChart>
              </ResponsiveContainer>

              <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mt-6">
                <StatCard icon="📊" label="Media" value="24.42 años" color="blue" />
                <StatCard icon="📍" label="Mediana" value="22 años" color="purple" />
                <StatCard icon="🎯" label="Moda" value="19 años" color="green" />
                <StatCard icon="📏" label="Desv. Est." value="6.38 años" color="orange" />
              </div>

              <InsightBox title="Análisis Etario" color="blue">
                <p>• Grupo 20-24 años predomina con 47.3% (2,834 estudiantes)</p>
                <p>• Moda de 19 años indica fuerte ingreso post-secundaria</p>
                <p>• Desviación estándar de 6.38 años muestra dispersión moderada</p>
                <p>• 26.14% de coeficiente de variación indica variabilidad etaria considerable</p>
              </InsightBox>
            </div>
          </div>
        )}

        {/* Tab 3: Tipo de Institución */}
            {activeTab === 3 && (
          <div className="bg-white rounded-3xl shadow-2xl p-8 min-h-[600px] animate-fadeIn">
            <h2 className="text-4xl md:text-5xl font-bold text-gray-900 mb-8 text-center">Tipo de Institución</h2>
            <div>
              <ResponsiveContainer width="100%" height={500}>
                <BarChart data={institutionData} layout="vertical">
                  <CartesianGrid strokeDasharray="3 3" stroke="#d1d5db" strokeWidth={2} />
                  <XAxis
                    type="number"
                    tick={{ fill: '#1e293b', fontSize: 16, fontWeight: 'bold' }}
                  />
                  <YAxis
                    dataKey="name"
                    type="category"
                    width={250}
                    tick={{ fill: '#1e293b', fontSize: 14, fontWeight: 'bold' }}
                  />
                  <Tooltip content={<CustomTooltip />} />
                  <Legend wrapperStyle={{ fontSize: '16px', fontWeight: 'bold' }} />
                  <Bar dataKey="students" fill="#45B7D1" radius={[0, 12, 12, 0]}>
                    {institutionData.map((entry, index) => (
                      <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                    ))}
                  </Bar>
                </BarChart>
              </ResponsiveContainer>

              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mt-6">
                {institutionData.map((inst, index) => (
                  <div key={index} className="bg-gradient-to-br from-gray-50 to-gray-100 rounded-lg p-4 shadow">
                    <div className="text-sm text-gray-600">{inst.name}</div>
                    <div className="text-2xl font-bold text-gray-800">{inst.students.toLocaleString('es-CL')}</div>
                    <div className="text-xs text-gray-500">{inst.percentage}%</div>
                  </div>
                ))}
              </div>

              <InsightBox title="Análisis Institucional" color="indigo">
                <p>• U. Magallanes concentra 41% como institución CRUCH líder regional</p>
                <p>• INACAP lidera formación técnico-profesional con 30.6%</p>
                <p>• Universidades privadas solo 18.8%, baja penetración regional</p>
                <p>• CFT e IP representan segmento importante de formación técnica</p>
              </InsightBox>
            </div>
          </div>
        )}

        {/* Tab 4: Modalidad y Jornada */}
            {activeTab === 4 && (
          <div className="bg-white rounded-3xl shadow-2xl p-8 min-h-[600px] animate-fadeIn">
            <h2 className="text-3xl font-bold text-gray-800 mb-6">Modalidad de Estudio y Jornada</h2>
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              {/* Modalidad */}
              <div className="bg-white rounded-xl shadow-xl p-8">
                <h3 className="text-xl font-bold text-gray-800 mb-4">Modalidad de Estudio</h3>
                <ResponsiveContainer width="100%" height={300}>
                  <PieChart>
                    <Pie
                      data={modalityData}
                      cx="50%"
                      cy="50%"
                      labelLine={false}
                      label={({ name, percentage }) => `${name}: ${percentage}%`}
                      outerRadius={100}
                      fill="#8884d8"
                      dataKey="value"
                    >
                      {modalityData.map((entry, index) => (
                        <Cell key={`cell-${index}`} fill={COLORS[index]} />
                      ))}
                    </Pie>
                    <Tooltip content={<CustomTooltip />} />
                  </PieChart>
                </ResponsiveContainer>
              </div>

              {/* Jornada */}
              <div className="bg-white rounded-xl shadow-xl p-8">
                <h3 className="text-xl font-bold text-gray-800 mb-4">Jornada</h3>
                <ResponsiveContainer width="100%" height={300}>
                  <BarChart data={scheduleData}>
                    <CartesianGrid strokeDasharray="3 3" />
                    <XAxis dataKey="name" />
                    <YAxis />
                    <Tooltip content={<CustomTooltip />} />
                    <Bar dataKey="students" fill="#98D8C8" radius={[12, 12, 0, 0]} label={renderCustomLabel}>
                      {scheduleData.map((entry, index) => (
                        <Cell key={`cell-${index}`} fill={COLORS[index + 2]} />
                      ))}
                    </Bar>
                  </BarChart>
                </ResponsiveContainer>
              </div>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
              <StatCard icon="🏫" label="Presencial" value="5,821" sublabel="97.2% del total" color="blue" />
              <StatCard icon="☀️" label="Diurno" value="4,245" sublabel="60.9% del total" color="orange" />
              <StatCard icon="🌙" label="Vespertino" value="1,689" sublabel="24.2% del total" color="purple" />
            </div>

            <InsightBox title="Análisis Modalidad y Jornada" color="green">
              <p>• 97.2% presencial: preferencia regional clara por modalidad tradicional</p>
              <p>• Solo 2.8% online, muy por debajo de tendencias post-pandemia</p>
              <p>• Jornada diurna predomina (60.9%), pero vespertino/ejecutivo suma 39.1%</p>
              <p>• Segmento importante de estudiantes trabajadores en jornadas alternativas</p>
            </InsightBox>
          </div>
        )}

        {/* Tab 5: Áreas de Conocimiento */}
            {activeTab === 5 && (
          <div className="bg-white rounded-3xl shadow-2xl p-8 min-h-[600px] animate-fadeIn">
            <h2 className="text-4xl md:text-5xl font-bold text-gray-900 mb-8 text-center">Áreas de Conocimiento</h2>
            <div>
              <ResponsiveContainer width="100%" height={600}>
                <BarChart data={knowledgeAreasData} layout="vertical">
                  <CartesianGrid strokeDasharray="3 3" stroke="#d1d5db" strokeWidth={2} />
                  <XAxis
                    type="number"
                    tick={{ fill: '#1e293b', fontSize: 16, fontWeight: 'bold' }}
                  />
                  <YAxis
                    dataKey="area"
                    type="category"
                    width={230}
                    tick={{ fill: '#1e293b', fontSize: 14, fontWeight: 'bold' }}
                  />
                  <Tooltip content={<CustomTooltip />} />
                  <Legend wrapperStyle={{ fontSize: '16px', fontWeight: 'bold' }} />
                  <Bar dataKey="students" fill="#F7DC6F" radius={[0, 12, 12, 0]}>
                    {knowledgeAreasData.map((entry, index) => (
                      <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                    ))}
                  </Bar>
                </BarChart>
              </ResponsiveContainer>

              <div className="grid grid-cols-2 md:grid-cols-5 gap-4 mt-6">
                {knowledgeAreasData.slice(0, 5).map((area, index) => (
                  <div key={index} className="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg p-4 shadow">
                    <div className="text-xs text-gray-600 mb-1">#{index + 1}</div>
                    <div className="text-sm font-semibold text-gray-800 mb-1">{area.area}</div>
                    <div className="text-xl font-bold text-indigo-600">{area.students.toLocaleString('es-CL')}</div>
                    <div className="text-xs text-gray-500">{area.percentage}%</div>
                  </div>
                ))}
              </div>

              <InsightBox title="Análisis por Áreas" color="purple">
                <p>• Salud lidera con 25.1% (1,501 estudiantes), seguido por Tecnología (22.2%)</p>
                <p>• Top 3 áreas (Salud, Tecnología, Adm. y Comercio) concentran 67.7% de matrícula</p>
                <p>• Refleja necesidades regionales: salud, tecnología, servicios</p>
                <p>• Áreas tradicionales como Educación (10.9%) y Derecho (8.2%) mantienen presencia</p>
              </InsightBox>
            </div>
          </div>
        )}

        {/* Tab 6: Duración de Carreras */}
            {activeTab === 6 && (
          <div className="bg-white rounded-3xl shadow-2xl p-8 min-h-[600px] animate-fadeIn">
            <h2 className="text-4xl md:text-5xl font-bold text-gray-900 mb-8 text-center">Duración de Carreras</h2>
            <div>
              <ResponsiveContainer width="100%" height={500}>
                <BarChart data={durationData}>
                  <CartesianGrid strokeDasharray="3 3" stroke="#d1d5db" strokeWidth={2} />
                  <XAxis
                    dataKey="duration"
                    tick={{ fill: '#1e293b', fontSize: 16, fontWeight: 'bold' }}
                    height={60}
                  />
                  <YAxis
                    tick={{ fill: '#1e293b', fontSize: 16, fontWeight: 'bold' }}
                  />
                  <Tooltip content={<CustomTooltip />} />
                  <Legend wrapperStyle={{ fontSize: '16px', fontWeight: 'bold' }} />
                  <Bar dataKey="programs" fill="#BB8FCE" radius={[12, 12, 0, 0]} label={renderCustomLabel}>
                    {durationData.map((entry, index) => (
                      <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                    ))}
                  </Bar>
                </BarChart>
              </ResponsiveContainer>

              <div className="grid grid-cols-2 md:grid-cols-5 gap-4 mt-6">
                <StatCard icon="📊" label="Media" value="7.86 sem" sublabel="~4 años" color="blue" />
                <StatCard icon="📍" label="Mediana" value="8 sem" sublabel="4 años" color="purple" />
                <StatCard icon="🎯" label="Moda" value="10 sem" sublabel="5 años" color="green" />
                <StatCard icon="📏" label="Rango" value="13 sem" sublabel="Variabilidad alta" color="orange" />
                <StatCard icon="📐" label="Desv. Est." value="3.1 sem" sublabel="CV: 39.48%" color="pink" />
              </div>

              <InsightBox title="Análisis de Duración" color="indigo">
                <p>• Moda de 10 semestres (34.4%): predominan carreras profesionales completas (5 años)</p>
                <p>• Media de 7.86 semestres indica mezcla importante de carreras técnicas (2-3 años)</p>
                <p>• Coef. Variación 39.48%: alta diversidad en duración de programas</p>
                <p>• Rango de 13 semestres: desde técnicos cortos (4 sem) hasta medicina/pedagogías (14+ sem)</p>
              </InsightBox>
            </div>
          </div>
        )}

        {/* Tab 7: Costos */}
            {activeTab === 7 && (
          <div className="bg-white rounded-3xl shadow-2xl p-8 min-h-[600px] animate-fadeIn">
            <h2 className="text-4xl md:text-5xl font-bold text-gray-900 mb-8 text-center">Costos</h2>
            <div>
              <ResponsiveContainer width="100%" height={500}>
                <BarChart data={costsData}>
                  <CartesianGrid strokeDasharray="3 3" stroke="#d1d5db" strokeWidth={2} />
                  <XAxis
                    dataKey="range"
                    angle={-15}
                    textAnchor="end"
                    height={100}
                    tick={{ fill: '#1e293b', fontSize: 14, fontWeight: 'bold' }}
                  />
                  <YAxis
                    tick={{ fill: '#1e293b', fontSize: 16, fontWeight: 'bold' }}
                  />
                  <Tooltip content={<CustomTooltip />} />
                  <Legend wrapperStyle={{ fontSize: '16px', fontWeight: 'bold' }} />
                  <Bar dataKey="matricula" fill="#85C1E2" name="Matrícula" radius={[12, 12, 0, 0]} />
                  <Bar dataKey="arancel" fill="#F8B739" name="Arancel" radius={[12, 12, 0, 0]} />
                </BarChart>
              </ResponsiveContainer>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                {/* Matrícula */}
                <div className="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-6 shadow-lg">
                  <h4 className="text-lg font-bold text-gray-800 mb-4">💳 Matrícula</h4>
                  <div className="space-y-2 text-sm">
                    <div className="flex justify-between">
                      <span className="text-gray-600">Media:</span>
                      <span className="font-bold">$145,774</span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-gray-600">Mediana:</span>
                      <span className="font-bold">$137,000</span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-gray-600">Moda:</span>
                      <span className="font-bold">$137,000</span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-gray-600">Rango:</span>
                      <span className="font-bold">$290,000</span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-gray-600">Desv. Est.:</span>
                      <span className="font-bold">$50,895</span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-gray-600">Coef. Variación:</span>
                      <span className="font-bold text-orange-600">34.91%</span>
                    </div>
                  </div>
                </div>

                {/* Arancel */}
                <div className="bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg p-6 shadow-lg">
                  <h4 className="text-lg font-bold text-gray-800 mb-4">💰 Arancel</h4>
                  <div className="space-y-2 text-sm">
                    <div className="flex justify-between">
                      <span className="text-gray-600">Media:</span>
                      <span className="font-bold">$2,693,403</span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-gray-600">Mediana:</span>
                      <span className="font-bold">$2,234,000</span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-gray-600">Moda:</span>
                      <span className="font-bold">$3,555,000</span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-gray-600">Rango:</span>
                      <span className="font-bold">$5,011,000</span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-gray-600">Desv. Est.:</span>
                      <span className="font-bold">$1,070,871</span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-gray-600">Coef. Variación:</span>
                      <span className="font-bold text-orange-600">39.76%</span>
                    </div>
                  </div>
                </div>
              </div>

              <InsightBox title="Análisis de Costos" color="orange">
                <p>• Alta variabilidad: Coef. Variación ~35-40% indica gran diversidad de programas y precios</p>
                <p>• Matrícula modal $137.000 (valor más frecuente, coincide con mediana)</p>
                <p>• Arancel modal $3.555.000 superior a media de $2.693.403, sugiere concentración en programas de mayor costo</p>
                <p>• Desviación estándar del arancel superior a $1M indica gran dispersión en precios</p>
                <p>• Rango arancel $5.011.000: desde CFT económicos hasta carreras medicina/ingeniería de alto costo</p>
              </InsightBox>
            </div>
          </div>
        )}

        {/* Controles de Presentación - Siempre visibles */}
        <div className="fixed bottom-8 left-1/2 transform -translate-x-1/2 z-50">
          <div className="bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 rounded-full shadow-2xl px-8 py-4 flex items-center gap-6">
            {/* Botón Anterior */}
            <button
              onClick={prevSlide}
              className="bg-white/20 hover:bg-white/30 text-white rounded-full p-4 transition-all duration-300 hover:scale-110 backdrop-blur-sm"
              title="Anterior (← o flecha izquierda)"
            >
              <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M15 19l-7-7 7-7" />
              </svg>
            </button>

            {/* Indicador de Progreso */}
            <div className="flex items-center gap-3">
              {[0, 1, 2, 3, 4, 5, 6, 7].map((index) => (
                <button
                  key={index}
                  onClick={() => setActiveTab(index)}
                  className={`transition-all duration-300 rounded-full ${
                    activeTab === index
                      ? 'w-12 h-4 bg-white'
                      : 'w-4 h-4 bg-white/40 hover:bg-white/60'
                  }`}
                  title={`Ir a sección ${index + 1}`}
                />
              ))}
            </div>

            {/* Botón Siguiente */}
            <button
              onClick={nextSlide}
              className="bg-white/20 hover:bg-white/30 text-white rounded-full p-4 transition-all duration-300 hover:scale-110 backdrop-blur-sm"
              title="Siguiente (→ o barra espaciadora)"
            >
              <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M9 5l7 7-7 7" />
              </svg>
            </button>

            {/* Contador de slides */}
            <div className="ml-4 text-white font-bold text-xl">
              {activeTab + 1} / 8
            </div>
          </div>
        </div>

        {/* Ayuda de teclado (solo mostrar cuando NO es intro) */}
        {!showIntro && (
          <div className="fixed top-4 right-4 bg-black/80 text-white px-6 py-4 rounded-xl text-sm backdrop-blur-sm z-40">
            <div className="font-bold text-lg mb-2">⌨️ Atajos de Teclado</div>
            <div className="space-y-1 opacity-90">
              <div>→ : Siguiente sección</div>
              <div>← : Sección anterior</div>
              <div>Espacio : Siguiente sección</div>
              <div>1-8 : Ir a sección específica</div>
            </div>
          </div>
        )}
          </>
        )}
      </div>
    </div>
  );
}

export default App;
